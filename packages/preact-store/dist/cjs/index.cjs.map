{"version":3,"file":"index.cjs","sources":["../../src/index.ts"],"sourcesContent":["import { effect, signal } from \"@preact/signals\";\nimport type { Derived, Store } from \"@tanstack/store\";\n\nexport * from \"@tanstack/store\";\n\n/**\n * @private\n */\nexport type NoInfer<T> = [T][T extends any ? 0 : never];\n\nexport function useStore<TState, TSelected = NoInfer<TState>>(\n\tstore: Store<TState, any>,\n\tselector?: (state: NoInfer<TState>) => TSelected,\n): TSelected;\nexport function useStore<TState, TSelected = NoInfer<TState>>(\n\tstore: Derived<TState, any>,\n\tselector?: (state: NoInfer<TState>) => TSelected,\n): TSelected;\n// eslint-disable-next-line @eslint-react/hooks-extra/no-useless-custom-hooks\nexport function useStore<TState, TSelected = NoInfer<TState>>(\n\tstore: Store<TState, any> | Derived<TState, any>,\n\tselector: (state: NoInfer<TState>) => TSelected = (d) => d as any,\n): TSelected {\n\tconst slice = signal<TSelected>(selector(store.state));\n\n\teffect(() => {\n\t\tconst unsub = store.subscribe(() => {\n\t\t\tconst data = selector(store.state);\n\t\t\tif (shallow(slice.value, data)) {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tslice.value = data;\n\t\t});\n\n\t\treturn () => {\n\t\t\tunsub();\n\t\t};\n\t});\n\n\treturn slice.value;\n}\n\nexport function shallow<T>(objA: T, objB: T) {\n\tif (Object.is(objA, objB)) {\n\t\treturn true;\n\t}\n\n\tif (\n\t\ttypeof objA !== \"object\" ||\n\t\tobjA === null ||\n\t\ttypeof objB !== \"object\" ||\n\t\tobjB === null\n\t) {\n\t\treturn false;\n\t}\n\n\tif (objA instanceof Map && objB instanceof Map) {\n\t\tif (objA.size !== objB.size) return false;\n\t\tfor (const [k, v] of objA) {\n\t\t\tif (!objB.has(k) || !Object.is(v, objB.get(k))) return false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tif (objA instanceof Set && objB instanceof Set) {\n\t\tif (objA.size !== objB.size) return false;\n\t\tfor (const v of objA) {\n\t\t\tif (!objB.has(v)) return false;\n\t\t}\n\t\treturn true;\n\t}\n\n\tconst keysA = Object.keys(objA);\n\tif (keysA.length !== Object.keys(objB).length) {\n\t\treturn false;\n\t}\n\n\t// eslint-disable-next-line @typescript-eslint/prefer-for-of\n\tfor (let i = 0; i < keysA.length; i++) {\n\t\tif (\n\t\t\t!Object.prototype.hasOwnProperty.call(objB, keysA[i] as string) ||\n\t\t\t!Object.is(objA[keysA[i] as keyof T], objB[keysA[i] as keyof T])\n\t\t) {\n\t\t\treturn false;\n\t\t}\n\t}\n\treturn true;\n}\n"],"names":["store","signal","effect"],"mappings":";;;;AAmBO,SAAS,SACfA,QACA,WAAkD,CAAC,MAAM,GAC7C;AACZ,QAAM,QAAQC,QAAA,OAAkB,SAASD,OAAM,KAAK,CAAC;AAErDE,UAAAA,OAAO,MAAM;AACN,UAAA,QAAQF,OAAM,UAAU,MAAM;AAC7B,YAAA,OAAO,SAASA,OAAM,KAAK;AACjC,UAAI,QAAQ,MAAM,OAAO,IAAI,GAAG;AAC/B;AAAA,MAAA;AAED,YAAM,QAAQ;AAAA,IAAA,CACd;AAED,WAAO,MAAM;AACN,YAAA;AAAA,IACP;AAAA,EAAA,CACA;AAED,SAAO,MAAM;AACd;AAEgB,SAAA,QAAW,MAAS,MAAS;AAC5C,MAAI,OAAO,GAAG,MAAM,IAAI,GAAG;AACnB,WAAA;AAAA,EAAA;AAIP,MAAA,OAAO,SAAS,YAChB,SAAS,QACT,OAAO,SAAS,YAChB,SAAS,MACR;AACM,WAAA;AAAA,EAAA;AAGJ,MAAA,gBAAgB,OAAO,gBAAgB,KAAK;AAC/C,QAAI,KAAK,SAAS,KAAK,KAAa,QAAA;AACpC,eAAW,CAAC,GAAG,CAAC,KAAK,MAAM;AAC1B,UAAI,CAAC,KAAK,IAAI,CAAC,KAAK,CAAC,OAAO,GAAG,GAAG,KAAK,IAAI,CAAC,CAAC,EAAU,QAAA;AAAA,IAAA;AAEjD,WAAA;AAAA,EAAA;AAGJ,MAAA,gBAAgB,OAAO,gBAAgB,KAAK;AAC/C,QAAI,KAAK,SAAS,KAAK,KAAa,QAAA;AACpC,eAAW,KAAK,MAAM;AACrB,UAAI,CAAC,KAAK,IAAI,CAAC,EAAU,QAAA;AAAA,IAAA;AAEnB,WAAA;AAAA,EAAA;AAGF,QAAA,QAAQ,OAAO,KAAK,IAAI;AAC9B,MAAI,MAAM,WAAW,OAAO,KAAK,IAAI,EAAE,QAAQ;AACvC,WAAA;AAAA,EAAA;AAIR,WAAS,IAAI,GAAG,IAAI,MAAM,QAAQ,KAAK;AAErC,QAAA,CAAC,OAAO,UAAU,eAAe,KAAK,MAAM,MAAM,CAAC,CAAW,KAC9D,CAAC,OAAO,GAAG,KAAK,MAAM,CAAC,CAAY,GAAG,KAAK,MAAM,CAAC,CAAY,CAAC,GAC9D;AACM,aAAA;AAAA,IAAA;AAAA,EACR;AAEM,SAAA;AACR;;;;;;;;;"}